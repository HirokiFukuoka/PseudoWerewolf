<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>コイン判別ゲーム</title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f5f5f5; }
    .coin { width: 40px; height: 40px; border-radius: 50%; margin: 5px; background: #ddd; display: inline-block; line-height: 40px; font-weight: bold; cursor: pointer; }
    .selected-left { background-color: #87ceeb; }
    .selected-right { background-color: #ffb6c1; }
    .disabled { opacity: 0.5; pointer-events: none; }
    #scaleResult, #log { margin-top: 20px; }
    button { margin: 10px; }
  </style>
</head>
<body>

<h2>🔍 コイン判別ゲーム</h2>
<div id="coins"></div>

<p>左の皿に乗せる → 青色、右の皿に乗せる → ピンク色</p>

<button onclick="useScale()">天秤を使う</button>
<p id="scaleResult"></p>

<p>廃棄するコイン番号を選択（残り天秤回数 <span id="scaleCount">7</span>）</p>
<select id="discardSelect"></select>
<button onclick="discard()">コインを廃棄</button>

<div id="log"></div>

<script>
const coinCount = 16;
let coins = [];
let leftPan = [];
let rightPan = [];
let scaleUses = 7;
let destroyedThisTurn = false;

function init() {
  coins = [];
  for (let i = 1; i <= coinCount; i++) {
    coins.push({ id: i, type: 'A', weight: 10 });
  }
  // ランダムに偽物Bを4つ選定
  let fakeIndexes = [];
  while (fakeIndexes.length < 4) {
    let idx = Math.floor(Math.random() * coinCount);
    if (!fakeIndexes.includes(idx)) fakeIndexes.push(idx);
  }
  fakeIndexes.forEach(i => {
    coins[i].type = 'B';
    coins[i].weight = 7;
  });
  renderCoins();
}

function renderCoins() {
  const container = document.getElementById('coins');
  container.innerHTML = '';
  leftPan = [];
  rightPan = [];
  destroyedThisTurn = false;

  coins.forEach(coin => {
    const btn = document.createElement('div');
    btn.className = 'coin';
    btn.innerText = coin.id;
    btn.onclick = () => selectCoin(coin.id);
    container.appendChild(btn);
  });

  updateDiscardOptions();
  document.getElementById('scaleResult').innerText = '';
}

function selectCoin(id) {
  const coinEl = document.querySelectorAll('.coin')[id - 1];
  if (!coinEl.classList.contains('selected-left') && !coinEl.classList.contains('selected-right')) {
    if (leftPan.length <= rightPan.length) {
      leftPan.push(id);
      coinEl.classList.add('selected-left');
    } else {
      rightPan.push(id);
      coinEl.classList.add('selected-right');
    }
  }
}

function useScale() {
  if (scaleUses <= 0 || destroyedThisTurn) return;
  const leftWeight = leftPan.reduce((sum, id) => sum + getCoin(id).weight, 0);
  const rightWeight = rightPan.reduce((sum, id) => sum + getCoin(id).weight, 0);
  let result = '';
  if (leftWeight > rightWeight) result = '⚖️ 天秤は左に傾きました';
  else if (leftWeight < rightWeight) result = '⚖️ 天秤は右に傾きました';
  else result = '⚖️ 天秤は釣り合いました';

  document.getElementById('scaleResult').innerText = result;

  // 自動消滅：Aで確信度の高いもの
  const safeA = coins.filter(c => c.type === 'A');
  if (safeA.length > 0) {
    const destroyed = safeA[Math.floor(Math.random() * safeA.length)];
    destroyCoin(destroyed.id, true);
  }

  scaleUses--;
  document.getElementById('scaleCount').innerText = scaleUses;
  destroyedThisTurn = true;
  checkWinOrLose();
}

function updateDiscardOptions() {
  const select = document.getElementById('discardSelect');
  select.innerHTML = '';
  coins.forEach(c => {
    let opt = document.createElement('option');
    opt.value = c.id;
    opt.text = `${c.id}番`;
    select.appendChild(opt);
  });
}

function discard() {
  const id = parseInt(document.getElementById('discardSelect').value);
  destroyCoin(id, false);
  renderCoins();
  checkWinOrLose();
}

function getCoin(id) {
  return coins.find(c => c.id === id);
}

function destroyCoin(id, auto) {
  coins = coins.filter(c => c.id !== id);
  const log = document.getElementById('log');
  const msg = auto ? `🧨 ${id}番のコインが自動的に消滅しました` : `🗑️ ${id}番のコインを廃棄しました`;
  log.innerHTML += `<p>${msg}</p>`;
}

function checkWinOrLose() {
  const remainingA = coins.filter(c => c.type === 'A').length;
  const remainingB = coins.filter(c => c.type === 'B').length;
  if (remainingB === 0) {
    alert('🎉 勝利！偽物Bをすべて廃棄しました');
  } else if (remainingA === remainingB) {
    alert('💥 失敗！AとBの数が同数になりました');
  }
}

init();
</script>
</body>
</html>
