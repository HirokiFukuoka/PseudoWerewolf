<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚³ã‚¤ãƒ³åˆ¤åˆ¥ã‚²ãƒ¼ãƒ </title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f5f5f5; }
    .coin { width: 40px; height: 40px; border-radius: 50%; margin: 5px; background: #ddd; display: inline-block; line-height: 40px; font-weight: bold; cursor: pointer; }
    .selected-left { background-color: #87ceeb; }
    .selected-right { background-color: #ffb6c1; }
    .disabled { opacity: 0.5; pointer-events: none; }
    #scaleResult, #log { margin-top: 20px; }
    button { margin: 10px; }
  </style>
</head>
<body>

<h2>ğŸ” ã‚³ã‚¤ãƒ³åˆ¤åˆ¥ã‚²ãƒ¼ãƒ </h2>
<div id="coins"></div>

<p>å·¦ã®çš¿ã«ä¹—ã›ã‚‹ â†’ é’è‰²ã€å³ã®çš¿ã«ä¹—ã›ã‚‹ â†’ ãƒ”ãƒ³ã‚¯è‰²</p>

<button onclick="useScale()">å¤©ç§¤ã‚’ä½¿ã†</button>
<p id="scaleResult"></p>

<p>å»ƒæ£„ã™ã‚‹ã‚³ã‚¤ãƒ³ç•ªå·ã‚’é¸æŠï¼ˆæ®‹ã‚Šå¤©ç§¤å›æ•° <span id="scaleCount">7</span>ï¼‰</p>
<select id="discardSelect"></select>
<button onclick="discard()">ã‚³ã‚¤ãƒ³ã‚’å»ƒæ£„</button>

<div id="log"></div>

<script>
const coinCount = 16;
let coins = [];
let leftPan = [];
let rightPan = [];
let scaleUses = 7;
let destroyedThisTurn = false;

function init() {
  coins = [];
  for (let i = 1; i <= coinCount; i++) {
    coins.push({ id: i, type: 'A', weight: 10 });
  }
  // ãƒ©ãƒ³ãƒ€ãƒ ã«å½ç‰©Bã‚’4ã¤é¸å®š
  let fakeIndexes = [];
  while (fakeIndexes.length < 4) {
    let idx = Math.floor(Math.random() * coinCount);
    if (!fakeIndexes.includes(idx)) fakeIndexes.push(idx);
  }
  fakeIndexes.forEach(i => {
    coins[i].type = 'B';
    coins[i].weight = 7;
  });
  renderCoins();
}

function renderCoins() {
  const container = document.getElementById('coins');
  container.innerHTML = '';
  leftPan = [];
  rightPan = [];
  destroyedThisTurn = false;

  coins.forEach(coin => {
    const btn = document.createElement('div');
    btn.className = 'coin';
    btn.innerText = coin.id;
    btn.onclick = () => selectCoin(coin.id);
    container.appendChild(btn);
  });

  updateDiscardOptions();
  document.getElementById('scaleResult').innerText = '';
}

function selectCoin(id) {
  const coinEl = document.querySelectorAll('.coin')[id - 1];
  if (!coinEl.classList.contains('selected-left') && !coinEl.classList.contains('selected-right')) {
    if (leftPan.length <= rightPan.length) {
      leftPan.push(id);
      coinEl.classList.add('selected-left');
    } else {
      rightPan.push(id);
      coinEl.classList.add('selected-right');
    }
  }
}

function useScale() {
  if (scaleUses <= 0 || destroyedThisTurn) return;
  const leftWeight = leftPan.reduce((sum, id) => sum + getCoin(id).weight, 0);
  const rightWeight = rightPan.reduce((sum, id) => sum + getCoin(id).weight, 0);
  let result = '';
  if (leftWeight > rightWeight) result = 'âš–ï¸ å¤©ç§¤ã¯å·¦ã«å‚¾ãã¾ã—ãŸ';
  else if (leftWeight < rightWeight) result = 'âš–ï¸ å¤©ç§¤ã¯å³ã«å‚¾ãã¾ã—ãŸ';
  else result = 'âš–ï¸ å¤©ç§¤ã¯é‡£ã‚Šåˆã„ã¾ã—ãŸ';

  document.getElementById('scaleResult').innerText = result;

  // è‡ªå‹•æ¶ˆæ»…ï¼šAã§ç¢ºä¿¡åº¦ã®é«˜ã„ã‚‚ã®
  const safeA = coins.filter(c => c.type === 'A');
  if (safeA.length > 0) {
    const destroyed = safeA[Math.floor(Math.random() * safeA.length)];
    destroyCoin(destroyed.id, true);
  }

  scaleUses--;
  document.getElementById('scaleCount').innerText = scaleUses;
  destroyedThisTurn = true;
  checkWinOrLose();
}

function updateDiscardOptions() {
  const select = document.getElementById('discardSelect');
  select.innerHTML = '';
  coins.forEach(c => {
    let opt = document.createElement('option');
    opt.value = c.id;
    opt.text = `${c.id}ç•ª`;
    select.appendChild(opt);
  });
}

function discard() {
  const id = parseInt(document.getElementById('discardSelect').value);
  destroyCoin(id, false);
  renderCoins();
  checkWinOrLose();
}

function getCoin(id) {
  return coins.find(c => c.id === id);
}

function destroyCoin(id, auto) {
  coins = coins.filter(c => c.id !== id);
  const log = document.getElementById('log');
  const msg = auto ? `ğŸ§¨ ${id}ç•ªã®ã‚³ã‚¤ãƒ³ãŒè‡ªå‹•çš„ã«æ¶ˆæ»…ã—ã¾ã—ãŸ` : `ğŸ—‘ï¸ ${id}ç•ªã®ã‚³ã‚¤ãƒ³ã‚’å»ƒæ£„ã—ã¾ã—ãŸ`;
  log.innerHTML += `<p>${msg}</p>`;
}

function checkWinOrLose() {
  const remainingA = coins.filter(c => c.type === 'A').length;
  const remainingB = coins.filter(c => c.type === 'B').length;
  if (remainingB === 0) {
    alert('ğŸ‰ å‹åˆ©ï¼å½ç‰©Bã‚’ã™ã¹ã¦å»ƒæ£„ã—ã¾ã—ãŸ');
  } else if (remainingA === remainingB) {
    alert('ğŸ’¥ å¤±æ•—ï¼Aã¨Bã®æ•°ãŒåŒæ•°ã«ãªã‚Šã¾ã—ãŸ');
  }
}

init();
</script>
</body>
</html>
